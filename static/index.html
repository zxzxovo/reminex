<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reminex - Êñá‰ª∂ÊêúÁ¥¢ÂºïÊìé</title>
    <style>
        :root {
            /* Material Design 3 - Light Theme (Blue) */
            --md-sys-color-primary: #1976D2;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #BBDEFB;
            --md-sys-color-on-primary-container: #0D47A1;
            --md-sys-color-secondary: #0288D1;
            --md-sys-color-on-secondary: #FFFFFF;
            --md-sys-color-secondary-container: #B3E5FC;
            --md-sys-color-on-secondary-container: #01579B;
            --md-sys-color-surface: #FFFFFF;
            --md-sys-color-on-surface: #1D1B20;
            --md-sys-color-surface-variant: #E7E0EC;
            --md-sys-color-on-surface-variant: #49454F;
            --md-sys-color-outline: #79747E;
            --md-sys-color-outline-variant: #CAC4D0;
            --md-sys-color-background: #F8F9FA;
            --md-sys-color-on-background: #202124;
            --md-sys-color-error: #B3261E;
            --md-sys-color-on-error: #FFFFFF;
            --md-sys-color-surface-container-lowest: #FFFFFF;
            --md-sys-color-surface-container-low: #FFFFFF;
            --md-sys-color-surface-container: #F8F9FA;
            --md-sys-color-surface-container-high: #F1F3F4;
            --md-sys-color-surface-container-highest: #E8EAED;
            
            /* Shadows */
            --md-sys-elevation-1: 0 1px 2px 0 rgba(0, 0, 0, 0.3), 0 1px 3px 1px rgba(0, 0, 0, 0.15);
            --md-sys-elevation-2: 0 1px 2px 0 rgba(0, 0, 0, 0.3), 0 2px 6px 2px rgba(0, 0, 0, 0.15);
            --md-sys-elevation-3: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 4px 8px 3px rgba(0, 0, 0, 0.15);
        }

        [data-theme="dark"] {
            /* Material Design 3 - Dark Theme (Blue) */
            --md-sys-color-primary: #90CAF9;
            --md-sys-color-on-primary: #0D47A1;
            --md-sys-color-primary-container: #1565C0;
            --md-sys-color-on-primary-container: #BBDEFB;
            --md-sys-color-secondary: #81D4FA;
            --md-sys-color-on-secondary: #01579B;
            --md-sys-color-secondary-container: #0277BD;
            --md-sys-color-on-secondary-container: #B3E5FC;
            --md-sys-color-surface: #1D1B20;
            --md-sys-color-on-surface: #E6E0E9;
            --md-sys-color-surface-variant: #49454F;
            --md-sys-color-on-surface-variant: #CAC4D0;
            --md-sys-color-outline: #938F99;
            --md-sys-color-outline-variant: #49454F;
            --md-sys-color-background: #1D1B20;
            --md-sys-color-on-background: #E6E0E9;
            --md-sys-color-error: #F2B8B5;
            --md-sys-color-on-error: #601410;
            --md-sys-color-surface-container-lowest: #0F0D13;
            --md-sys-color-surface-container-low: #1D1B20;
            --md-sys-color-surface-container: #211F26;
            --md-sys-color-surface-container-high: #2B2930;
            --md-sys-color-surface-container-highest: #36343B;
            
            /* Shadows for dark mode */
            --md-sys-elevation-1: 0 1px 3px 1px rgba(0, 0, 0, 0.15), 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --md-sys-elevation-2: 0 2px 6px 2px rgba(0, 0, 0, 0.15), 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --md-sys-elevation-3: 0 4px 8px 3px rgba(0, 0, 0, 0.15), 0 1px 3px 0 rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica', 'Arial', sans-serif;
            background-color: var(--md-sys-color-background);
            color: var(--md-sys-color-on-background);
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            flex: 1;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 8px;
            color: var(--md-sys-color-primary);
            font-weight: 400;
            letter-spacing: 0;
        }

        .header p {
            font-size: 1em;
            color: var(--md-sys-color-on-surface-variant);
        }

        .theme-toggle {
            width: 48px;
            height: 48px;
            border-radius: 24px;
            border: none;
            background-color: var(--md-sys-color-surface-container-highest);
            color: var(--md-sys-color-on-surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: background-color 0.2s;
        }

        .theme-toggle:hover {
            background-color: var(--md-sys-color-surface-container-high);
        }

        .search-box {
            background-color: var(--md-sys-color-surface-container-low);
            border-radius: 28px;
            padding: 24px;
            box-shadow: var(--md-sys-elevation-1);
            margin-bottom: 24px;
            transition: background-color 0.3s;
        }

        .search-input-container {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 16px 24px;
            font-size: 16px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 28px;
            outline: none;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            transition: border-color 0.2s, background-color 0.3s, color 0.3s;
        }

        .search-input:focus {
            border-color: var(--md-sys-color-primary);
            border-width: 2px;
            padding: 15px 23px;
        }

        .search-button {
            padding: 16px 32px;
            font-size: 16px;
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border: none;
            border-radius: 28px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s, box-shadow 0.2s;
            box-shadow: var(--md-sys-elevation-1);
        }

        .search-button:hover {
            box-shadow: var(--md-sys-elevation-2);
        }

        .search-button:active {
            box-shadow: var(--md-sys-elevation-1);
        }

        .search-button:disabled {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            cursor: not-allowed;
            box-shadow: none;
        }

        .icon-button {
            padding: 16px;
            font-size: 18px;
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        .icon-button:hover:not(:disabled) {
            box-shadow: var(--md-sys-elevation-1);
        }

        .icon-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-button {
            padding: 10px 24px;
            font-size: 14px;
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s, box-shadow 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .nav-button:hover {
            box-shadow: var(--md-sys-elevation-1);
        }

        .options {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--md-sys-color-primary);
        }

        .option label {
            cursor: pointer;
            user-select: none;
            color: var(--md-sys-color-on-surface);
            font-size: 14px;
        }

        .option select,
        .option input[type="number"],
        .option input[type="text"] {
            padding: 8px 12px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 8px;
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            font-size: 14px;
            transition: border-color 0.2s, background-color 0.3s, color 0.3s;
        }

        .option select:focus,
        .option input[type="number"]:focus,
        .option input[type="text"]:focus {
            outline: none;
            border-color: var(--md-sys-color-primary);
            border-width: 2px;
            padding: 7px 11px;
        }

        .db-select {
            width: 220px;
        }

        .limit-input {
            width: 80px;
        }

        .root-path-input {
            width: 180px;
        }

        .filter-input {
            width: 200px;
        }

        .advanced-toggle {
            padding: 8px 16px;
            background-color: transparent;
            color: var(--md-sys-color-primary);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .advanced-toggle:hover {
            background-color: var(--md-sys-color-surface-variant);
            border-color: var(--md-sys-color-primary);
        }

        .advanced-toggle-icon {
            transition: transform 0.3s;
            font-size: 12px;
        }

        .advanced-toggle-icon.expanded {
            transform: rotate(-180deg);
        }

        .advanced-options {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, margin-top 0.3s ease-out;
        }

        .advanced-options.show {
            max-height: 500px;
            margin-top: 16px;
        }

        .compact-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 16px;
        }

        .compact-label {
            font-size: 13px;
            color: var(--md-sys-color-on-surface);
            white-space: nowrap;
        }

        .compact-buttons {
            display: flex;
            gap: 4px;
        }

        .compact-btn {
            padding: 4px 10px;
            font-size: 12px;
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .compact-btn:hover {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
        }

        .compact-btn.active {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border-color: var(--md-sys-color-primary);
        }

        /* Compact mode styles */
        body.compact-relaxed .result-section {
            margin-bottom: 24px;
        }

        body.compact-relaxed .result-header {
            padding: 16px 24px;
        }

        body.compact-relaxed .tree {
            font-size: 14px;
            line-height: 1.7;
            padding: 16px 20px;
        }

        body.compact-relaxed .tree-node {
            margin: 3px 0;
        }

        body.compact-normal .result-section {
            margin-bottom: 16px;
        }

        body.compact-normal .result-header {
            padding: 12px 20px;
        }

        body.compact-normal .tree {
            font-size: 13px;
            line-height: 1.5;
            padding: 12px 16px;
        }

        body.compact-normal .tree-node {
            margin: 1px 0;
        }

        body.compact-tight .result-section {
            margin-bottom: 12px;
        }

        body.compact-tight .result-header {
            padding: 10px 16px;
        }

        body.compact-tight .tree {
            font-size: 12px;
            line-height: 1.4;
            padding: 10px 12px;
        }

        body.compact-tight .tree-node {
            margin: 0;
        }

        .results {
            background-color: var(--md-sys-color-surface-container-low);
            border-radius: 28px;
            padding: 24px;
            padding-bottom: 80px; /* Extra space for scroll buttons */
            box-shadow: var(--md-sys-elevation-1);
            display: none;
            transition: background-color 0.3s;
            position: relative;
            overflow: visible; /* Ensure all content is visible */
            min-height: auto; /* No minimum height restriction */
        }

        .results.show {
            display: block;
        }

        .scroll-buttons {
            position: fixed;
            bottom: 24px;
            right: 24px;
            display: none;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .scroll-buttons.show {
            display: flex;
        }

        .scroll-button {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            border: none;
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--md-sys-elevation-2);
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        .scroll-button:hover {
            box-shadow: var(--md-sys-elevation-3);
            background-color: var(--md-sys-color-secondary-container);
        }

        .scroll-button:active {
            box-shadow: var(--md-sys-elevation-1);
        }

        .result-section {
            margin-bottom: 16px;
            background-color: var(--md-sys-color-surface-container);
            border-radius: 20px;
            box-shadow: var(--md-sys-elevation-1);
            overflow: hidden;
            transition: box-shadow 0.3s, background-color 0.3s;
        }

        .result-section:hover {
            box-shadow: var(--md-sys-elevation-2);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            transition: background-color 0.3s, color 0.3s;
            cursor: pointer;
            user-select: none;
        }

        .result-header:hover {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
        }

        .result-header-left {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .result-toggle {
            font-size: 0.75em;
            transition: transform 0.3s;
        }

        .result-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .root-path-hint {
            font-size: 0.7em;
            font-weight: 400;
            opacity: 0.75;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            margin-left: 4px;
            padding: 2px 6px;
            background-color: rgba(0, 0, 0, 0.15);
            border-radius: 6px;
        }

        .result-header h3 {
            font-size: 1.1em;
            font-weight: 500;
            margin: 0;
        }

        .result-count {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            padding: 3px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .result-content {
            max-height: 100000px;
            overflow: hidden;
            transition: max-height 0.4s ease-out, opacity 0.3s ease-out;
            opacity: 1;
        }

        .result-content.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .tree {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            padding: 12px 16px;
            background-color: transparent;
            overflow-x: auto;
            overflow-y: visible;
            transition: background-color 0.3s;
        }

        .tree-node {
            margin: 1px 0;
            white-space: pre;
        }

        .tree-folder {
            color: var(--md-sys-color-primary);
            font-weight: 500;
            cursor: pointer;
            user-select: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .tree-folder:hover {
            color: var(--md-sys-color-secondary);
        }

        .folder-path-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 11px;
            padding: 0;
            transition: background-color 0.2s, transform 0.2s;
            opacity: 0;
        }

        .tree-folder:hover .folder-path-btn {
            opacity: 1;
        }

        .folder-path-btn:hover {
            background-color: var(--md-sys-color-tertiary-container);
            transform: scale(1.15);
        }

        .folder-path-btn:active {
            transform: scale(0.95);
        }

        .path-popup {
            position: fixed;
            background-color: var(--md-sys-color-surface-container-high);
            color: var(--md-sys-color-on-surface);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 12px;
            padding: 12px 16px;
            box-shadow: var(--md-sys-elevation-3);
            z-index: 3000;
            max-width: 600px;
            word-wrap: break-word;
            display: none;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .path-popup.show {
            display: block;
        }

        .path-popup-header {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--md-sys-color-primary);
            font-size: 12px;
        }

        .path-popup-content {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 4px;
        }

        .path-segment {
            color: var(--md-sys-color-on-surface);
        }

        .path-separator {
            color: #1976D2;
            font-weight: bold;
            font-size: 16px;
            margin: 0 4px;
        }

        .path-popup-close {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: var(--md-sys-color-on-surface);
            cursor: pointer;
            font-size: 18px;
            padding: 2px 6px;
            line-height: 1;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .path-popup-close:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .tree-file {
            color: var(--md-sys-color-on-surface);
        }

        .tree-branch {
            color: var(--md-sys-color-outline);
            font-family: monospace;
            white-space: pre;
            flex-shrink: 0;
        }

        .tree-toggle {
            display: inline-block;
            width: 14px;
            color: var(--md-sys-color-primary);
            font-weight: bold;
            margin-right: 2px;
        }

        .tree-children {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            overflow: hidden;
        }
        
        .tree-node .tree-children .tree-children {
            margin-left: 16px;
        }

        .tree-children.collapsed {
            max-height: 0 !important;
            opacity: 0;
        }

        .folder-count {
            margin-left: 8px;
            color: var(--md-sys-color-error);
            font-weight: 600;
            font-size: 0.9em;
            display: none;
        }

        .folder-count.show {
            display: inline;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--md-sys-color-primary);
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--md-sys-color-surface-variant);
            border-top: 4px solid var(--md-sys-color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background-color: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
            padding: 16px 20px;
            border-radius: 12px;
            font-weight: 500;
        }

        .empty {
            text-align: center;
            padding: 40px;
            color: var(--md-sys-color-on-surface-variant);
            font-size: 1.1em;
        }

        .stats {
            text-align: center;
            color: var(--md-sys-color-on-surface-variant);
            margin-top: 24px;
            font-size: 0.875em;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--md-sys-color-surface);
            border-radius: 28px;
            padding: 24px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--md-sys-elevation-3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--md-sys-color-outline);
        }

        .modal-header h2 {
            margin: 0;
            color: var(--md-sys-color-on-surface);
        }

        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--md-sys-color-on-surface);
            padding: 8px;
            line-height: 1;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .close-button:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .modal-body {
            overflow-y: auto;
            flex: 1;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            justify-content: flex-end;
        }

        .primary-button {
            padding: 12px 24px;
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        .primary-button:hover {
            box-shadow: var(--md-sys-elevation-1);
        }

        .secondary-button {
            padding: 10px 20px;
            background-color: var(--md-sys-color-error-container);
            color: var(--md-sys-color-on-error-container);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s, box-shadow 0.2s;
            margin-right: 12px;
        }

        .secondary-button:hover {
            box-shadow: var(--md-sys-elevation-1);
        }

        /* History List */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
        }

        .history-item {
            padding: 16px;
            background-color: var(--md-sys-color-surface-container);
            border-radius: 16px;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        .history-item:hover {
            background-color: var(--md-sys-color-surface-container-high);
            box-shadow: var(--md-sys-elevation-1);
        }

        .history-item-query {
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
            margin-bottom: 8px;
        }

        .history-item-meta {
            font-size: 12px;
            color: var(--md-sys-color-on-surface-variant);
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .history-empty {
            text-align: center;
            color: var(--md-sys-color-on-surface-variant);
            padding: 40px;
        }

        /* Export Textarea */
        .export-textarea {
            width: 100%;
            min-height: 400px;
            padding: 16px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 12px;
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface);
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">
                <h1>‚ö° Reminex</h1>
            </div>
            <button id="themeToggle" class="theme-toggle" aria-label="ÂàáÊç¢‰∏ªÈ¢ò">
                üåô
            </button>
        </div>

        <div class="search-box">
            <div class="search-input-container">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="ËæìÂÖ•ÊêúÁ¥¢ÂÖ≥ÈîÆËØç (ÊîØÊåÅÂ§ö‰∏™ÂÖ≥ÈîÆËØçÔºåÁî® , ; Êàñ‰∏≠ÊñáÈÄóÂè∑„ÄÅÂàÜÂè∑ÂàÜÈöî)..."
                    autofocus
                >
                <button id="searchButton" class="search-button">üîç ÊêúÁ¥¢</button>
                <button id="historyButton" class="icon-button" title="ÊêúÁ¥¢ÂéÜÂè≤">üìú</button>
                <button id="exportButton" class="icon-button" title="ÂØºÂá∫ÁªìÊûú" disabled>üì§</button>
            </div>
            <div class="options">
                <div class="option">
                    <label for="databaseSelect">Êï∞ÊçÆÂ∫ì:</label>
                    <select id="databaseSelect" class="db-select">
                        <!-- Will be populated dynamically -->
                    </select>
                </div>
                <div class="option">
                    <button id="advancedToggle" class="advanced-toggle">
                        <span class="advanced-toggle-icon">‚ñº</span>
                        <span>È´òÁ∫ßÈÄâÈ°π</span>
                    </button>
                </div>
                <div class="compact-control">
                    <span class="compact-label">Á¥ßÂáëÂ∫¶:</span>
                    <div class="compact-buttons">
                        <button class="compact-btn" data-compact="relaxed">ÂÆΩÊùæ</button>
                        <button class="compact-btn active" data-compact="normal">Ê†áÂáÜ</button>
                        <button class="compact-btn" data-compact="tight">Á¥ßÂáë</button>
                    </div>
                </div>
                <div style="margin-left: auto;">
                    <a href="/indexer" class="nav-button">üìë ÂàõÂª∫Á¥¢Âºï</a>
                </div>
            </div>
            <div id="advancedOptions" class="advanced-options">
                <div class="options">
                    <div class="option">
                        <input type="checkbox" id="nameOnly">
                        <label for="nameOnly">‰ªÖÊêúÁ¥¢Êñá‰ª∂Âêç</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="caseSensitive">
                        <label for="caseSensitive">Âå∫ÂàÜÂ§ßÂ∞èÂÜô</label>
                    </div>
                    <div class="option">
                        <label for="limitInput">ÁªìÊûúÈôêÂà∂:</label>
                        <input type="number" id="limitInput" value="2000" min="1" max="10000" class="limit-input">
                    </div>
                </div>
                <div class="options" style="margin-top: 10px;">
                    <div class="option">
                        <label for="rootPathInput">ÊòæÁ§∫Ê†πË∑ØÂæÑ:</label>
                        <input type="text" id="rootPathInput" placeholder="Â¶Ç: D:\ Êàñ /mnt/data" 
                               class="root-path-input"
                               title="ÂèØÈÄâÔºöÊõøÊç¢ÊòæÁ§∫ÁªìÊûú‰∏≠ÁöÑÂéüÂßãÊ†πË∑ØÂæÑÔºàÊîØÊåÅÁõòÁ¨¶ÊõøÊç¢Ôºâ">
                    </div>
                    <div class="option">
                        <label for="includeFilterInput">ÂøÖÈ°ªÂåÖÂê´:</label>
                        <input type="text" id="includeFilterInput" placeholder="Áî®ÈÄóÂè∑ÂàÜÈöîÂ§ö‰∏™ÂÖ≥ÈîÆËØç" 
                               class="filter-input"
                               title="Á≠õÈÄâÂøÖÈ°ªÂêåÊó∂ÂåÖÂê´Ëøô‰∫õÂÖ≥ÈîÆËØçÁöÑÁªìÊûú">
                    </div>
                    <div class="option">
                        <label for="excludeFilterInput">ÂøÖÈ°ªÊéíÈô§:</label>
                        <input type="text" id="excludeFilterInput" placeholder="Áî®ÈÄóÂè∑ÂàÜÈöîÂ§ö‰∏™ÂÖ≥ÈîÆËØç" 
                               class="filter-input"
                               title="ÊéíÈô§ÂåÖÂê´Ëøô‰∫õÂÖ≥ÈîÆËØçÁöÑÁªìÊûú">
                    </div>
                </div>
            </div>
        </div>

        <div id="results" class="results">
            <!-- Results will be inserted here -->
        </div>

        <!-- Scroll buttons -->
        <div id="scrollButtons" class="scroll-buttons">
            <button id="scrollToTop" class="scroll-button" aria-label="ÂõûÂà∞È°∂ÈÉ®" title="ÂõûÂà∞È°∂ÈÉ®">
                ‚¨ÜÔ∏è
            </button>
            <button id="scrollToBottom" class="scroll-button" aria-label="Ë∑≥Âà∞Â∫ïÈÉ®" title="Ë∑≥Âà∞Â∫ïÈÉ®">
                ‚¨áÔ∏è
            </button>
        </div>

        <div class="stats">
            <p>Powered by Reminex - AI-Powered File Indexing & Search Engine</p>
        </div>

        <!-- History Modal -->
        <div id="historyModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üïí ÊêúÁ¥¢ÂéÜÂè≤</h2>
                    <div>
                        <button id="clearHistoryButton" class="secondary-button">Ê∏ÖÁ©∫ÂéÜÂè≤</button>
                        <button id="closeHistoryButton" class="close-button">‚úï</button>
                    </div>
                </div>
                <div id="historyList" class="history-list">
                    <!-- History items will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Export Modal -->
        <div id="exportModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üì§ ÂØºÂá∫ÊêúÁ¥¢ÁªìÊûú</h2>
                    <button id="closeExportButton" class="close-button">‚úï</button>
                </div>
                <div class="modal-body">
                    <p>ÂØºÂá∫Ê†ºÂºèÔºöTOML</p>
                    <textarea id="exportContent" class="export-textarea" readonly></textarea>
                    <div class="modal-actions">
                        <button id="copyExportButton" class="primary-button">üìã Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø</button>
                        <button id="downloadExportButton" class="primary-button">üíæ ‰∏ãËΩΩÊñá‰ª∂</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Path Popup -->
        <div id="pathPopup" class="path-popup">
            <button class="path-popup-close" id="pathPopupClose">‚úï</button>
            <div class="path-popup-header">ÂÆåÊï¥Ë∑ØÂæÑ</div>
            <div class="path-popup-content" id="pathPopupContent"></div>
        </div>
    </div>

    <script>
        // Theme Management
        const themeToggle = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;
        
        // Load theme from localStorage or default to light
        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);

        function setTheme(theme) {
            if (theme === 'dark') {
                htmlElement.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è';
            } else {
                htmlElement.removeAttribute('data-theme');
                themeToggle.textContent = 'üåô';
            }
            localStorage.setItem('theme', theme);
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        });

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const resultsDiv = document.getElementById('results');
        const nameOnlyCheckbox = document.getElementById('nameOnly');
        const caseSensitiveCheckbox = document.getElementById('caseSensitive');
        const limitInput = document.getElementById('limitInput');
        const rootPathInput = document.getElementById('rootPathInput');
        const includeFilterInput = document.getElementById('includeFilterInput');
        const excludeFilterInput = document.getElementById('excludeFilterInput');
        const databaseSelect = document.getElementById('databaseSelect');
        const scrollButtons = document.getElementById('scrollButtons');
        const scrollToTopBtn = document.getElementById('scrollToTop');
        const scrollToBottomBtn = document.getElementById('scrollToBottom');
        const advancedToggle = document.getElementById('advancedToggle');
        const advancedOptions = document.getElementById('advancedOptions');
        
        // History and Export
        const historyButton = document.getElementById('historyButton');
        const exportButton = document.getElementById('exportButton');
        const historyModal = document.getElementById('historyModal');
        const exportModal = document.getElementById('exportModal');
        const closeHistoryButton = document.getElementById('closeHistoryButton');
        const closeExportButton = document.getElementById('closeExportButton');
        const clearHistoryButton = document.getElementById('clearHistoryButton');
        const historyList = document.getElementById('historyList');
        const exportContent = document.getElementById('exportContent');
        const copyExportButton = document.getElementById('copyExportButton');
        const downloadExportButton = document.getElementById('downloadExportButton');

        let lastSearchResults = null;

        // Compact mode functionality
        const compactButtons = document.querySelectorAll('.compact-btn');
        
        // Load saved compact mode or default to 'normal'
        const savedCompactMode = localStorage.getItem('compactMode') || 'normal';
        document.body.classList.add('compact-' + savedCompactMode);
        compactButtons.forEach(btn => {
            if (btn.getAttribute('data-compact') === savedCompactMode) {
                btn.classList.add('active');
            }
        });
        
        compactButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const mode = btn.getAttribute('data-compact');
                
                // Remove all compact classes
                document.body.classList.remove('compact-relaxed', 'compact-normal', 'compact-tight');
                
                // Add selected class
                document.body.classList.add('compact-' + mode);
                
                // Update button states
                compactButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Save to localStorage
                localStorage.setItem('compactMode', mode);
            });
        });

        // Advanced options toggle functionality
        advancedToggle.addEventListener('click', () => {
            const icon = advancedToggle.querySelector('.advanced-toggle-icon');
            advancedOptions.classList.toggle('show');
            icon.classList.toggle('expanded');
        });

        // Scroll button functionality
        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        scrollToBottomBtn.addEventListener('click', () => {
            window.scrollTo({
                top: document.body.scrollHeight,
                behavior: 'smooth'
            });
        });

        // Show/hide scroll buttons based on scroll position
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            const hasResults = resultsDiv.classList.contains('show');
            const scrolled = window.scrollY > 300;
            
            if (hasResults && scrolled) {
                scrollButtons.classList.add('show');
            } else {
                scrollButtons.classList.remove('show');
            }

            // Auto-hide after 3 seconds of no scrolling
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                if (window.scrollY > 300) {
                    // Keep visible but could add a fade effect here
                }
            }, 3000);
        });

        // Load available databases on page load
        async function loadDatabases() {
            try {
                const response = await fetch('/api/databases');
                const data = await response.json();
                
                // Clear existing options
                databaseSelect.innerHTML = '';
                
                // Add database options
                if (data.databases.length > 0) {
                    // Add first database as default (selected)
                    const firstOption = document.createElement('option');
                    firstOption.value = data.databases[0].name;
                    firstOption.textContent = data.databases[0].name;
                    firstOption.selected = true;
                    databaseSelect.appendChild(firstOption);
                    
                    // Add remaining databases
                    for (let i = 1; i < data.databases.length; i++) {
                        const option = document.createElement('option');
                        option.value = data.databases[i].name;
                        option.textContent = data.databases[i].name;
                        databaseSelect.appendChild(option);
                    }
                    
                    // Add "all" option at the end
                    const allOption = document.createElement('option');
                    allOption.value = 'all';
                    allOption.textContent = 'ÂÖ®ÈÉ®Êï∞ÊçÆÂ∫ì';
                    databaseSelect.appendChild(allOption);
                    
                    // Show database count in title
                    document.title = `Reminex - ${data.databases.length} ‰∏™Êï∞ÊçÆÂ∫ì`;
                } else {
                    // No databases found, add placeholder
                    const option = document.createElement('option');
                    option.value = 'all';
                    option.textContent = 'Êó†Êï∞ÊçÆÂ∫ì';
                    databaseSelect.appendChild(option);
                }
            } catch (error) {
                console.error('Failed to load databases:', error);
            }
        }

        // Load databases when page loads
        loadDatabases();

        // History Modal Functions
        historyButton.addEventListener('click', async () => {
            await loadHistory();
            historyModal.classList.add('show');
        });

        closeHistoryButton.addEventListener('click', () => {
            historyModal.classList.remove('show');
        });

        clearHistoryButton.addEventListener('click', async () => {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊêúÁ¥¢ÂéÜÂè≤ÂêóÔºü')) {
                try {
                    const response = await fetch('/api/history/clear', { method: 'POST' });
                    const data = await response.json();
                    if (data.success) {
                        await loadHistory();
                    } else {
                        alert('Ê∏ÖÁ©∫ÂéÜÂè≤Â§±Ë¥•: ' + data.error);
                    }
                } catch (error) {
                    alert('Ê∏ÖÁ©∫ÂéÜÂè≤Â§±Ë¥•: ' + error.message);
                }
            }
        });

        historyModal.addEventListener('click', (e) => {
            if (e.target === historyModal) {
                historyModal.classList.remove('show');
            }
        });

        async function loadHistory() {
            try {
                const response = await fetch('/api/history');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Âä†ËΩΩÂéÜÂè≤Â§±Ë¥•');
                }

                if (!data.history || data.history.length === 0) {
                    historyList.innerHTML = '<div class="history-empty">ÊöÇÊó†ÊêúÁ¥¢ÂéÜÂè≤</div>';
                    return;
                }

                let html = '';
                for (const item of data.history) {
                    const date = new Date(item.timestamp);
                    const dateStr = date.toLocaleString('zh-CN');
                    
                    html += `
                        <div class="history-item" data-query="${escapeHtml(item.query)}" 
                             data-db="${escapeHtml(item.selected_db)}"
                             data-name-only="${item.name_only}"
                             data-case-sensitive="${item.case_sensitive}">
                            <div class="history-item-query">${escapeHtml(item.query)}</div>
                            <div class="history-item-meta">
                                <span>üìÖ ${dateStr}</span>
                                <span>üíæ ${escapeHtml(item.selected_db)}</span>
                                <span>üìä ${item.result_count} ‰∏™ÁªìÊûú</span>
                                ${item.name_only ? '<span>üìÑ ‰ªÖÊñá‰ª∂Âêç</span>' : ''}
                                ${item.case_sensitive ? '<span>üî§ Âå∫ÂàÜÂ§ßÂ∞èÂÜô</span>' : ''}
                            </div>
                        </div>
                    `;
                }

                historyList.innerHTML = html;

                // Add click handlers
                document.querySelectorAll('.history-item').forEach(item => {
                    item.addEventListener('click', () => {
                        searchInput.value = item.dataset.query;
                        databaseSelect.value = item.dataset.db;
                        nameOnlyCheckbox.checked = item.dataset.nameOnly === 'true';
                        caseSensitiveCheckbox.checked = item.dataset.caseSensitive === 'true';
                        historyModal.classList.remove('show');
                        performSearch();
                    });
                });
            } catch (error) {
                historyList.innerHTML = `<div class="error">Âä†ËΩΩÂéÜÂè≤Â§±Ë¥•: ${error.message}</div>`;
            }
        }

        // Export Modal Functions
        exportButton.addEventListener('click', async () => {
            if (!lastSearchResults) {
                alert('Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÊêúÁ¥¢ÁªìÊûú');
                return;
            }

            try {
                const response = await fetch('/api/export', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(lastSearchResults)
                });

                const data = await response.json();
                if (!data.success) {
                    throw new Error(data.error || 'ÂØºÂá∫Â§±Ë¥•');
                }

                exportContent.value = data.toml;
                exportModal.classList.add('show');
            } catch (error) {
                alert('ÂØºÂá∫Â§±Ë¥•: ' + error.message);
            }
        });

        closeExportButton.addEventListener('click', () => {
            exportModal.classList.remove('show');
        });

        exportModal.addEventListener('click', (e) => {
            if (e.target === exportModal) {
                exportModal.classList.remove('show');
            }
        });

        copyExportButton.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(exportContent.value);
                alert('‚úÖ Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
            } catch (error) {
                // Fallback
                exportContent.select();
                document.execCommand('copy');
                alert('‚úÖ Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
            }
        });

        downloadExportButton.addEventListener('click', () => {
            const blob = new Blob([exportContent.value], { type: 'text/toml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reminex_search_${new Date().toISOString().split('T')[0]}.toml`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });


        // Search on Enter key
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Search on button click
        searchButton.addEventListener('click', performSearch);

        async function performSearch() {
            const query = searchInput.value.trim();
            if (!query) {
                alert('ËØ∑ËæìÂÖ•ÊêúÁ¥¢ÂÖ≥ÈîÆËØç');
                return;
            }

            // Show loading state
            searchButton.disabled = true;
            searchButton.textContent = 'ÊêúÁ¥¢‰∏≠...';
            resultsDiv.innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>Ê≠£Âú®ÊêúÁ¥¢...</p></div>';
            resultsDiv.classList.add('show');

            try {
                const params = new URLSearchParams({
                    query: query,
                    selected_db: databaseSelect.value,
                    name_only: nameOnlyCheckbox.checked,
                    case_sensitive: caseSensitiveCheckbox.checked,
                    limit: limitInput.value
                });

                // Add root_path if specified
                const rootPath = rootPathInput.value.trim();
                if (rootPath) {
                    params.append('root_path', rootPath);
                }

                // Add filters if specified
                const includeFilter = includeFilterInput.value.trim();
                if (includeFilter) {
                    params.append('include_filters', includeFilter);
                }

                const excludeFilter = excludeFilterInput.value.trim();
                if (excludeFilter) {
                    params.append('exclude_filters', excludeFilter);
                }

                const response = await fetch(`/api/search?${params}`);
                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'ÊêúÁ¥¢Â§±Ë¥•');
                }

                // ‰øùÂ≠òÊêúÁ¥¢ÁªìÊûúÁî®‰∫éÂØºÂá∫
                lastSearchResults = {
                    query: query,
                    selected_db: databaseSelect.value,
                    name_only: nameOnlyCheckbox.checked,
                    case_sensitive: caseSensitiveCheckbox.checked,
                    limit: parseInt(limitInput.value),
                    include_filters: includeFilter ? includeFilter.split(/[,Ôºå;Ôºõ]/).map(s => s.trim()).filter(s => s) : [],
                    exclude_filters: excludeFilter ? excludeFilter.split(/[,Ôºå;Ôºõ]/).map(s => s.trim()).filter(s => s) : [],
                    results: data.results
                };

                displayResults(data.results);
                
                // ÂêØÁî®ÂØºÂá∫ÊåâÈíÆ
                exportButton.disabled = false;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå ÈîôËØØ: ${error.message}</div>`;
                exportButton.disabled = true;
            } finally {
                searchButton.disabled = false;
                searchButton.textContent = 'üîç ÊêúÁ¥¢';
            }
        }

        function displayResults(results) {
            if (!results || results.length === 0) {
                resultsDiv.innerHTML = '<div class="empty">üòï Ê≤°ÊúâÊâæÂà∞‰ªª‰ΩïÁªìÊûú</div>';
                return;
            }

            // Reset node ID counter for new results
            nodeIdCounter = 0;

            let html = '';
            for (let i = 0; i < results.length; i++) {
                const result = results[i];
                const rootPathHtml = result.root_path ? `<span class="root-path-hint">${escapeHtml(result.root_path)}</span>` : '';
                
                // Render children of root node directly (skip root node itself)
                let treeContent = '';
                if (result.tree && result.tree.children && result.tree.children.length > 0) {
                    result.tree.children.forEach((child, index) => {
                        const isLast = index === result.tree.children.length - 1;
                        treeContent += renderTree(child, '', isLast);
                    });
                } else if (result.tree && result.tree.is_leaf) {
                    // If root itself is a file (single result), show it
                    treeContent = `<div class="tree-node"><span class="tree-file">${escapeHtml(result.tree.name)}</span></div>`;
                } else {
                    treeContent = '<div class="empty">Êó†ÁªìÊûú</div>';
                }
                
                html += `
                    <div class="result-section">
                        <div class="result-header" data-result-id="${i}">
                            <div class="result-header-left">
                                <span class="result-toggle">‚ñº</span>
                                <h3>„Äå${escapeHtml(result.keyword)}„Äç</h3>
                                ${rootPathHtml}
                            </div>
                            <span class="result-count">${result.count} ‰∏™ÁªìÊûú</span>
                        </div>
                        <div class="result-content" id="result-content-${i}">
                            <div class="tree">
                                ${treeContent}
                            </div>
                        </div>
                    </div>
                `;
            }

            resultsDiv.innerHTML = html;
            
            // Add click handlers for result section headers
            const resultHeaders = document.querySelectorAll('.result-header');
            resultHeaders.forEach(header => {
                header.addEventListener('click', function(e) {
                    const resultId = this.getAttribute('data-result-id');
                    const content = document.getElementById('result-content-' + resultId);
                    const toggle = this.querySelector('.result-toggle');
                    
                    if (content) {
                        content.classList.toggle('collapsed');
                        toggle.classList.toggle('collapsed');
                    }
                });
            });
            
            // Add click handlers for collapsible folders
            const folders = document.querySelectorAll('.tree-folder');
            
            folders.forEach(folder => {
                folder.addEventListener('click', function(e) {
                    // Don't toggle if clicking the path button
                    if (e.target.classList.contains('folder-path-btn')) {
                        return;
                    }
                    
                    e.stopPropagation();
                    const nodeId = this.getAttribute('data-node-id');
                    const children = document.getElementById('children-' + nodeId);
                    const toggle = this.querySelector('.tree-toggle');
                    const countSpan = this.querySelector('.folder-count');
                    
                    if (children) {
                        children.classList.toggle('collapsed');
                        if (children.classList.contains('collapsed')) {
                            toggle.textContent = '‚ñ∂';
                            children.style.maxHeight = '0';
                            // Show count when collapsed
                            if (countSpan) {
                                countSpan.classList.add('show');
                            }
                        } else {
                            toggle.textContent = '‚ñº';
                            children.style.maxHeight = 'none';
                            // Hide count when expanded
                            if (countSpan) {
                                countSpan.classList.remove('show');
                            }
                        }
                    }
                });
            });
        }

        // Count files in a node tree recursively
        function countFiles(node) {
            if (!node) return 0;
            if (node.is_leaf) return 1;
            
            let count = 0;
            if (node.children && node.children.length > 0) {
                for (const child of node.children) {
                    count += countFiles(child);
                }
            }
            return count;
        }

        let nodeIdCounter = 0;

        // Check if a node is a leaf folder (all children are files)
        function isLeafFolder(node) {
            if (!node || node.is_leaf) return false;
            if (!node.children || node.children.length === 0) return false;
            return node.children.every(child => child.is_leaf);
        }

        function renderTree(node, prefix = '', isLast = true, depth = 0) {
            if (!node) return '';

            const connector = isLast ? '‚îî‚îÄ ' : '‚îú‚îÄ ';
            const nodeId = nodeIdCounter++;
            
            let html = '';
            
            if (node.is_leaf) {
                // File node - no toggle
                html = `<div class="tree-node"><span class="tree-branch">${prefix}${connector}</span><span class="tree-file">${escapeHtml(node.name)}</span></div>`;
            } else {
                // Folder node - with toggle
                const hasChildren = node.children && node.children.length > 0;
                const toggle = hasChildren ? '‚ñº' : '';
                const fileCount = countFiles(node);
                
                // Auto-collapse logic:
                // - Must be at depth >= 3 (0-indexed, so depth >= 2 means 3+ levels)
                // - Must be a leaf folder (all children are files)
                // - Must have 8 or more files
                const shouldAutoCollapse = depth >= 2 && isLeafFolder(node) && fileCount >= 8;
                const collapseClass = shouldAutoCollapse ? ' collapsed' : '';
                const toggleIcon = shouldAutoCollapse ? '‚ñ∂' : toggle;
                const countClass = shouldAutoCollapse ? ' show' : '';
                
                html = `<div class="tree-node"><span class="tree-branch">${prefix}${connector}</span><span class="tree-folder" data-node-id="${nodeId}" data-path="${escapeHtml(node.path)}"><span class="tree-toggle">${toggleIcon}</span>${escapeHtml(node.name + '/')}<span class="folder-count${countClass}">(${fileCount})</span><button class="folder-path-btn" title="ÊòæÁ§∫ÂÆåÊï¥Ë∑ØÂæÑ">üìç</button></span></div>`;
                
                if (hasChildren) {
                    const newPrefix = prefix + (isLast ? '  ' : '‚îÇ ');
                    let childrenHtml = '';
                    node.children.forEach((child, index) => {
                        const childIsLast = index === node.children.length - 1;
                        childrenHtml += renderTree(child, newPrefix, childIsLast, depth + 1);
                    });
                    
                    // Apply collapsed class and inline style if auto-collapsing
                    const childrenStyle = shouldAutoCollapse ? ' style="max-height: 0;"' : ' style="max-height: none;"';
                    html += `<div id="children-${nodeId}" class="tree-children${collapseClass}"${childrenStyle}>${childrenHtml}</div>`;
                }
            }

            return html;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Path popup functionality
        const pathPopup = document.getElementById('pathPopup');
        const pathPopupContent = document.getElementById('pathPopupContent');
        const pathPopupClose = document.getElementById('pathPopupClose');

        // Close popup when clicking close button
        pathPopupClose.addEventListener('click', () => {
            pathPopup.classList.remove('show');
        });

        // Close popup when clicking outside
        document.addEventListener('click', (e) => {
            if (pathPopup.classList.contains('show') && 
                !pathPopup.contains(e.target) && 
                !e.target.classList.contains('folder-path-btn')) {
                pathPopup.classList.remove('show');
            }
        });

        // Add event delegation for path buttons
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('folder-path-btn')) {
                e.stopPropagation();
                const folder = e.target.closest('.tree-folder');
                const fullPath = folder.getAttribute('data-path');
                
                if (fullPath) {
                    // Parse path and create segments with arrow separators
                    const pathParts = fullPath.split(/[/\\]/);
                    let pathHtml = '';
                    
                    pathParts.forEach((part, index) => {
                        if (part) {
                            pathHtml += `<span class="path-segment">${escapeHtml(part)}</span>`;
                            if (index < pathParts.length - 1 && pathParts[index + 1]) {
                                pathHtml += `<span class="path-separator">‚Üí</span>`;
                            }
                        }
                    });
                    
                    pathPopupContent.innerHTML = pathHtml;
                    
                    // Position popup near the button
                    const rect = e.target.getBoundingClientRect();
                    const popupWidth = 600; // max-width from CSS
                    
                    let left = rect.right + 10;
                    let top = rect.top;
                    
                    // Adjust if would go off screen
                    if (left + popupWidth > window.innerWidth) {
                        left = rect.left - popupWidth - 10;
                    }
                    
                    if (left < 10) {
                        left = 10;
                    }
                    
                    if (top + 100 > window.innerHeight) {
                        top = window.innerHeight - 110;
                    }
                    
                    pathPopup.style.left = left + 'px';
                    pathPopup.style.top = top + 'px';
                    pathPopup.classList.add('show');
                }
            }
        });
    </script>
</body>
</html>
